<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function - ê²Œì„ í†µê³„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #0f0f0f;
            min-height: 100vh;
            padding: 10px;
            color: #b4b4b4;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-container {
            max-width: 450px;
            margin: 100px auto;
            background: #1a1a1a;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            border: 1px solid #2a2a2a;
        }
        .login-container h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #e0e0e0;
            font-size: 28px;
        }
        .login-container input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #2a2a2a;
            background: #141414;
            color: #b4b4b4;
            font-size: 16px;
        }
        .login-container label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            color: #808080;
            cursor: pointer;
        }
        .login-container input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
        .login-container button {
            width: 100%;
            padding: 15px;
            margin: 15px 0 5px 0;
            border-radius: 8px;
            border: none;
            background: #3a3a3a;
            color: #e0e0e0;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-container button:hover { background: #4a4a4a; transform: translateY(-2px); }
        
        /* ë©”ì¸ í™”ë©´ */
        .main-view { display: none; }
        .main-view.active { display: block; }
        
        /* í—¤ë” */
        .header {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 18px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .header h1 { 
            color: #e0e0e0;
            font-size: 22px;
            font-weight: 700;
        }
        .header-right { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .username-badge {
            background: #3a3a3a;
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .admin-badge {
            background: #4a4a4a;
            color: #e0e0e0;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 5px;
        }
        .logout-btn {
            background: #f85149;
            color: white;
            padding: 6px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        .logout-btn:hover { background: #da3633; }
        
        /* ë¯¸ë‹ˆì°½ ìŠ¤íƒ€ì¼ ì‹¤ì‹œê°„ ì •ë³´ */
        .live-mini-window {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .live-mini-window h2 {
            color: #e0e0e0;
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        .mini-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        .mini-stat-box {
            background: #141414;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s;
        }
        .mini-stat-box:hover { 
            transform: translateY(-3px); 
            border-color: #3a3a3a;
            background: #1a1a1a;
        }
        .mini-stat-title {
            color: #808080;
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .mini-stat-value {
            color: #b4b4b4;
            font-size: 24px;
            font-weight: bold;
        }
        .mini-status-bar {
            background: #141414;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            text-align: center;
        }
        .mini-status-text {
            color: #808080;
            font-size: 14px;
        }
        .mini-status-text.in-game {
            color: #86efac;
            font-weight: bold;
        }
        .mini-tags {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .mini-tag {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #e0e0e0;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .mini-tag:hover {
            background: #3a3a3a;
            border-color: #4a4a4a;
            transform: translateY(-1px);
        }
        
        /* íƒ­ */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .tab-btn {
            padding: 12px 24px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 10px;
            color: #808080;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
        }
        .tab-btn:hover { 
            background: #202020;
            color: #b4b4b4;
            border-color: #3a3a3a;
        }
        .tab-btn.active { 
            background: #2a2a2a;
            color: #e0e0e0;
            border-color: #4a4a4a;
        }
        
        /* ì¹´ë“œ */
        .card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: #3a3a3a;
        }
        .card h2 { 
            color: #e0e0e0; 
            margin-bottom: 20px; 
            font-size: 20px;
            font-weight: 600;
        }
        
        /* í†µê³„ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            text-align: center;
            padding: 20px 15px;
            background: #202020;
            border: 1px solid #3a3a3a;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .stat-box:hover { 
            transform: translateY(-3px); 
            background: #2a2a2a;
            border-color: #4a4a4a;
        }
        .stat-value { 
            font-size: 36px; 
            font-weight: bold; 
            color: #e0e0e0;
        }
        .stat-label { 
            font-size: 13px; 
            margin-top: 8px; 
            color: #808080;
            font-weight: 500;
        }
        
        /* ìƒ‰ìƒ ë³€í˜• */
        .stat-box.green { 
            background: #1a2e26;
            border-color: #2d4a3e;
        }
        .stat-box.green:hover { 
            background: #1e3a2e;
            border-color: #3a5a4d;
        }
        .stat-box.green .stat-value { 
            color: #86efac;
        }
        
        .stat-box.red { 
            background: #2e1a1a;
            border-color: #4a2d2d;
        }
        .stat-box.red:hover { 
            background: #3a1e1e;
            border-color: #5a3a3a;
        }
        .stat-box.red .stat-value { 
            color: #fca5a5;
        }
        
        .stat-box.yellow { 
            background: #2e2a1a;
            border-color: #4a422d;
        }
        .stat-box.yellow:hover { 
            background: #3a341e;
            border-color: #5a523a;
        }
        .stat-box.yellow .stat-value { 
            color: #fcd34d;
        }
        
        .stat-box.purple { 
            background: #251a2e;
            border-color: #3d2d4a;
        }
        .stat-box.purple:hover { 
            background: #2e1e3a;
            border-color: #4d3a5a;
        }
        .stat-box.purple .stat-value { 
            color: #c4b5fd;
        }
        
        .stat-box.orange { 
            background: #2e221a;
            border-color: #4a382d;
        }
        .stat-box.orange:hover { 
            background: #3a2a1e;
            border-color: #5a483a;
        }
        .stat-box.orange .stat-value { 
            color: #fdba74;
        }
        
        /* í…Œì´ë¸” */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            border-radius: 10px;
            background: #141414;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #2a2a2a;
        }
        th {
            background: #202020;
            color: #b4b4b4;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr:hover { 
            background: #1a1a1a;
            transition: all 0.2s ease;
        }
        
        /* ë­í‚¹ */
        .rank-1 { background: #ffd700 !important; color: #000 !important; font-weight: bold; }
        .rank-2 { background: #c0c0c0 !important; color: #000 !important; font-weight: bold; }
        .rank-3 { background: #cd7f32 !important; color: #000 !important; font-weight: bold; }
        .me-row { outline: 3px solid #1f6feb; }
        
        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-pending { background: #d29922; color: #000; }
        .status-approved { background: #238636; color: white; }
        .status-rejected { background: #f85149; color: white; }
        .status-suspended { background: #8b949e; color: white; }
        
        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons { display: flex; gap: 5px; flex-wrap: wrap; }
        .action-buttons button {
            padding: 5px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.2s;
        }
        .btn-approve { background: #238636; color: white; }
        .btn-approve:hover { background: #2ea043; }
        .btn-reject { background: #f85149; color: white; }
        .btn-reject:hover { background: #da3633; }
        .btn-suspend { background: #d29922; color: white; }
        .btn-suspend:hover { background: #b58318; }
        .btn-delete { background: #8b949e; color: white; }
        .btn-delete:hover { background: #6e7681; }
        
        /* ì°¨íŠ¸ */
        #chartContainer { height: 250px; margin: 15px 0; }
        
        /* ë©”ì‹œì§€ */
        .message {
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        .error { background: #ff4444; color: white; }
        .success { background: #00C851; color: white; }
        .warning { background: #ffbb33; color: #000; }
        
        /* íƒ­ ì»¨í…ì¸  */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            body { padding: 5px; }
            .header { padding: 10px; }
            .header h1 { font-size: 16px; }
            .login-container { margin: 50px auto; padding: 25px; }
            .card { padding: 15px; }
            .stat-value { font-size: 28px; }
            .mini-stat-value { font-size: 20px; }
            table { font-size: 12px; }
            th, td { padding: 8px 5px; }
            .tabs { gap: 5px; }
            .tab-btn { padding: 8px 15px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
        <div class="login-container" id="loginContainer">
            <h1>âš¡ Function</h1>
            
            <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… ì „í™˜ ë²„íŠ¼ -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button id="showLoginBtn" onclick="showLoginForm()" style="flex: 1; background: #1f6feb;">ë¡œê·¸ì¸</button>
                <button id="showSignupBtn" onclick="showSignupForm()" style="flex: 1; background: #30363d;">íšŒì›ê°€ì…</button>
            </div>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <div id="loginForm">
                <input type="text" id="loginUsername" placeholder="ì‚¬ìš©ìëª…">
                <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                <label>
                    <input type="checkbox" id="autoLoginCheck" checked>
                    <span>ìë™ ë¡œê·¸ì¸</span>
                </label>
                <button onclick="login()">ë¡œê·¸ì¸</button>
            </div>
            
            <!-- íšŒì›ê°€ì… í¼ -->
            <div id="signupForm" style="display: none;">
                <div style="color: #58a6ff; font-size: 13px; margin-bottom: 15px; padding: 10px; background: rgba(88, 166, 255, 0.1); border-radius: 6px; border: 1px solid #30363d;">
                    âš½ <strong>ì•„ì´ë””ëŠ” í”¼íŒŒ ë‹‰ë„¤ì„ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”</strong>
                </div>
                <input type="text" id="signupUsername" placeholder="í”¼íŒŒ ë‹‰ë„¤ì„ (2-20ì, í•œê¸€/ì˜ì–´/ìˆ«ì)">
                <input type="password" id="signupPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ (6-12ì)">
                <input type="password" id="signupPasswordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
                <div style="color: #8b949e; font-size: 12px; margin: 10px 0; line-height: 1.5;">
                    âš ï¸ ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´:<br>
                    â€¢ 6~12ì<br>
                    â€¢ ì˜ì–´, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ê°€ì§€ ì´ìƒ í¬í•¨
                </div>
                <button onclick="signup()">íšŒì›ê°€ì…</button>
            </div>
            
            <div id="loginMessage"></div>
        </div>
        
        <!-- ë©”ì¸ í™”ë©´ -->
        <div class="main-view" id="mainView">
            <!-- í—¤ë” -->
            <div class="header">
                <h1>âš¡ Function</h1>
                <div class="header-right">
                    <span class="username-badge">
                        <span id="headerUsername"></span>
                        <span id="adminBadge" style="display:none;" class="admin-badge">ê´€ë¦¬ì</span>
                    </span>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            
            <!-- ê³µì§€ì‚¬í•­ ë°°ë„ˆ -->
            <div id="announcementBanner" style="display: none;"></div>
            
            <!-- ê´€ë¦¬ì ê³µì§€ ì‘ì„± (ê´€ë¦¬ìë§Œ ë³´ì„) -->
            <div id="announcementAdmin" style="display: none;">
                <div style="background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #58a6ff; margin-bottom: 15px;">ğŸ“¢ ê³µì§€ì‚¬í•­ ì‘ì„±</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="announcementInput" placeholder="ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                               style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #2a2a2a; background: #141414; color: #b4b4b4;">
                        <select id="announcementType" style="padding: 12px; border-radius: 8px; border: 1px solid #2a2a2a; background: #141414; color: #b4b4b4;">
                            <option value="info">â„¹ï¸ ì •ë³´</option>
                            <option value="success">âœ… ì„±ê³µ</option>
                            <option value="warning">âš ï¸ ê²½ê³ </option>
                            <option value="error">ğŸš¨ ì¤‘ìš”</option>
                        </select>
                        <button onclick="createAnnouncement()" 
                                style="padding: 12px 24px; background: #238636; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ê²Œì‹œ
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ì‹¤ì‹œê°„ ë¯¸ë‹ˆ ì •ë³´ -->
            <div class="live-mini-window">
                <h2>ğŸ“¡ ì‹¤ì‹œê°„ ì •ë³´</h2>
                <div class="mini-stats-grid">
                    <div class="mini-stat-box">
                        <div class="mini-stat-title">ì ìˆ˜</div>
                        <div class="mini-stat-value" id="liveScore">--</div>
                    </div>
                    <div class="mini-stat-box">
                        <div class="mini-stat-title">ë“±ìˆ˜</div>
                        <div class="mini-stat-value" id="liveRank">--</div>
                    </div>
                    <div class="mini-stat-box">
                        <div class="mini-stat-title">í‹°ì–´</div>
                        <div class="mini-stat-value" id="liveTier" style="font-size: 14px;">--</div>
                    </div>
                    <div class="mini-stat-box">
                        <div class="mini-stat-title">ìŠ¹-ë¬´-íŒ¨</div>
                        <div class="mini-stat-value" id="liveWLD" style="font-size: 16px;">0-0-0</div>
                    </div>
                    <div class="mini-stat-box">
                        <div class="mini-stat-title">ì±„êµ´FC</div>
                        <div class="mini-stat-value" id="liveFC">0</div>
                    </div>
                    <div class="mini-stat-box">
                        <div class="mini-stat-title">íŒìˆ˜</div>
                        <div class="mini-stat-value" id="liveMatches">0</div>
                    </div>
                </div>
                <div class="mini-status-bar">
                    <div class="mini-status-text" id="liveStatus" style="display: none;"></div>
                    <div class="mini-tags" id="liveTags"></div>
                </div>
            </div>
            
            <!-- íƒ­ -->
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('today')">ì˜¤ëŠ˜</button>
                <button class="tab-btn" onclick="showTab('week')">7ì¼</button>
                <button class="tab-btn" onclick="showTab('history')">ì ìˆ˜ ê·¸ë˜í”„</button>
                <button class="tab-btn" onclick="showTab('ranking')">ğŸ† ë­í‚¹</button>
                <button class="tab-btn" onclick="showTab('updates')">ğŸ“¢ ì—…ë°ì´íŠ¸</button>
                <button class="tab-btn" id="adminTabBtn" style="display:none;" onclick="showTab('admin')">ğŸ‘‘ íšŒì›ê´€ë¦¬</button>
            </div>
            
            <!-- ì˜¤ëŠ˜ íƒ­ -->
            <div class="tab-content active" id="todayTab">
                <!-- ì¼ì¼ í†µê³„ -->
                <div class="card">
                    <h2>ğŸ“Š ì˜¤ëŠ˜ì˜ í†µê³„</h2>
                    <div class="stats-grid">
                        <div class="stat-box" style="background: #1a2e3a; border-color: #2a5a7a;">
                            <div class="stat-value" id="todayWins" style="color: #58a6ff;">0</div>
                            <div class="stat-label">ìŠ¹ë¦¬</div>
                        </div>
                        <div class="stat-box red">
                            <div class="stat-value" id="todayLosses">0</div>
                            <div class="stat-label">íŒ¨ë°°</div>
                        </div>
                        <div class="stat-box yellow">
                            <div class="stat-value" id="todayDraws">0</div>
                            <div class="stat-label">ë¬´ìŠ¹ë¶€</div>
                        </div>
                        <div class="stat-box green">
                            <div class="stat-value" id="todayFC">0</div>
                            <div class="stat-label">FC ì±„êµ´</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="todayMatches">0</div>
                            <div class="stat-label">íŒìˆ˜</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="todayWinrate">0%</div>
                            <div class="stat-label">ìŠ¹ë¥ </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="todayStartScore">--</div>
                            <div class="stat-label">ì‹œì‘ ì ìˆ˜</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="todayHighScore">--</div>
                            <div class="stat-label">ìµœê³  ì ìˆ˜</div>
                        </div>
                    </div>
                </div>
                
                <!-- ìŠˆì±Œâ†’ì±”ìŠ¤ ìŠ¹ê¸‰ ì •ë³´ -->
                <div class="card" id="promotionCard" style="display: none;">
                    <h2>ğŸ† ìŠˆì±Œ â†’ ì±”ìŠ¤ ìŠ¹ê¸‰</h2>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; color: #ffd700; margin-bottom: 10px;">ğŸ‰</div>
                        <div style="font-size: 24px; color: #58a6ff; font-weight: bold; margin-bottom: 10px;" id="promotionMatches">--íŒ</div>
                        <div style="color: #8b949e; font-size: 14px;" id="promotionDate">--</div>
                    </div>
                </div>
            </div>
            
            <!-- 7ì¼ íƒ­ -->
            <div class="tab-content" id="weekTab">
                <div class="card">
                    <h2>ğŸ“… ìµœê·¼ 7ì¼ í†µê³„</h2>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ë‚ ì§œ</th>
                                    <th>ìŠ¹</th>
                                    <th>ë¬´</th>
                                    <th>íŒ¨</th>
                                    <th>ìŠ¹ë¥ </th>
                                    <th>FC ì±„êµ´</th>
                                    <th>ìŠˆì±Œâ†’ì±”ìŠ¤</th>
                                </tr>
                            </thead>
                            <tbody id="weekTableBody">
                                <tr><td colspan="7" style="text-align:center;color:#8b949e;">ë¡œë”© ì¤‘...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ì ìˆ˜ ê·¸ë˜í”„ íƒ­ -->
            <div class="tab-content" id="historyTab">
                <div class="card">
                    <h2>ğŸ“ˆ ì ìˆ˜ ê·¸ë˜í”„</h2>
                    
                    <!-- ê²½ê¸° ìˆ˜ ì„ íƒ -->
                    <div style="text-align: center; margin-bottom: 15px;">
                        <button class="tab-btn" style="margin: 5px;" onclick="loadScoreGraph(100)">100ê²½ê¸°</button>
                        <button class="tab-btn" style="margin: 5px;" onclick="loadScoreGraph(200)">200ê²½ê¸°</button>
                        <button class="tab-btn active" style="margin: 5px;" onclick="loadScoreGraph(300)">300ê²½ê¸°</button>
                    </div>
                    
                    <div style="height: 350px;">
                        <canvas id="scoreChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ë­í‚¹ íƒ­ -->
            <div class="tab-content" id="rankingTab">
                <div class="card">
                    <h2>ğŸ† ë­í‚¹</h2>
                    
                    <!-- ë­í‚¹ íƒ€ì… ì„ íƒ -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <button class="tab-btn active" id="winsRankBtn" style="margin: 5px;" onclick="showRankingType('wins')">ìµœë‹¤ìŠ¹ ë­í‚¹</button>
                        <button class="tab-btn" id="scoreRankBtn" style="margin: 5px;" onclick="showRankingType('score')">ì‹¤ì‹œê°„ ì ìˆ˜ ë­í‚¹</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead id="rankingTableHead">
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>ì‚¬ìš©ìëª…</th>
                                    <th>ìŠ¹</th>
                                    <th>íŒ¨</th>
                                    <th>ë¬´</th>
                                    <th>ìŠ¹ë¥ </th>
                                </tr>
                            </thead>
                            <tbody id="rankingTableBody">
                                <tr><td colspan="6" style="text-align:center;color:#808080;">ë¡œë”© ì¤‘...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ì—…ë°ì´íŠ¸ íƒ­ -->
            <div class="tab-content" id="updatesTab">
                <div class="card">
                    <h2>ğŸ“¢ ì—…ë°ì´íŠ¸ ê³µì§€</h2>
                    
                    <!-- ê´€ë¦¬ìë§Œ ë³´ì´ëŠ” ì‘ì„± í¼ -->
                    <div id="updateWriteForm" style="display:none;">
                        <div style="background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
                            <h3 style="color: #e0e0e0; margin-bottom: 15px; font-size: 16px;">âœï¸ ì—…ë°ì´íŠ¸ ì‘ì„±/ìˆ˜ì •</h3>
                            <input type="text" id="updateVersion" placeholder="ë²„ì „ (ì˜ˆ: v1.0.0)" 
                                style="width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #2a2a2a; background: #0a0a0a; color: #e0e0e0;">
                            <input type="text" id="updateTitle" placeholder="ì œëª©" 
                                style="width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #2a2a2a; background: #0a0a0a; color: #e0e0e0;">
                            <textarea id="updateContent" placeholder="ì—…ë°ì´íŠ¸ ë‚´ìš© (ì¤„ë°”ê¿ˆì€ Enterë¡œ)" rows="5"
                                style="width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #2a2a2a; background: #0a0a0a; color: #e0e0e0; resize: vertical; line-height: 1.5;"></textarea>
                            <input type="url" id="updateDownloadUrl" placeholder="ë‹¤ìš´ë¡œë“œ ë§í¬ (ì„ íƒì‚¬í•­ - êµ¬ê¸€ ë“œë¼ì´ë¸Œ, GitHub ë“±)" 
                                style="width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #2a2a2a; background: #0a0a0a; color: #e0e0e0;">
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="postUpdate()" id="postUpdateBtn"
                                    style="flex: 1; padding: 12px; background: #238636; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                                    ğŸ“¤ ê²Œì‹œí•˜ê¸°
                                </button>
                                <button onclick="cancelEdit()" 
                                    style="padding: 12px 20px; background: #3a3a3a; color: #e0e0e0; border: 1px solid #4a4a4a; border-radius: 8px; cursor: pointer;">
                                    ì·¨ì†Œ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì—…ë°ì´íŠ¸ ëª©ë¡ -->
                    <div id="updatesList"></div>
                </div>
            </div>
            
            <!-- ê´€ë¦¬ì íƒ­ -->
            <div class="tab-content" id="adminTab">
                <div class="card">
                    <h2>ğŸ‘‘ íšŒì› ê´€ë¦¬</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="totalUsers">0</div>
                            <div class="stat-label">ì „ì²´</div>
                        </div>
                        <div class="stat-box yellow">
                            <div class="stat-value" id="pendingUsers">0</div>
                            <div class="stat-label">ëŒ€ê¸°</div>
                        </div>
                        <div class="stat-box green">
                            <div class="stat-value" id="approvedUsers">0</div>
                            <div class="stat-label">ìŠ¹ì¸</div>
                        </div>
                        <div class="stat-box orange">
                            <div class="stat-value" id="activeToday">0</div>
                            <div class="stat-label">ì˜¤ëŠ˜</div>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #d29922; font-size: 16px;">â³ ìŠ¹ì¸ ëŒ€ê¸°</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì‚¬ìš©ìëª…</th>
                                    <th>ê°€ì…ì¼ì‹œ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="pendingUsersBody"></tbody>
                        </table>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #238636; font-size: 16px;">âœ… ìŠ¹ì¸ëœ íšŒì›</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì‚¬ìš©ìëª…</th>
                                    <th>ë§ˆì§€ë§‰ ì ‘ì†</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="approvedUsersBody"></tbody>
                        </table>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #f85149; font-size: 16px;">â¸ ì •ì§€ëœ íšŒì›</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì‚¬ìš©ìëª…</th>
                                    <th>ì •ì§€ì¼ì‹œ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="suspendedUsersBody"></tbody>
                        </table>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #8b949e; font-size: 16px;">âœ— ê±°ë¶€ëœ íšŒì›</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì‚¬ìš©ìëª…</th>
                                    <th>ê±°ë¶€ì¼ì‹œ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="rejectedUsersBody"></tbody>
                        </table>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const SUPABASE_URL = 'https://tmbyzravuobepzicwpqe.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtYnl6cmF2dW9iZXB6aWN3cHFlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1ODg2NTksImV4cCI6MjA3NzE2NDY1OX0.XIb1VE_r3_7PHwaFSppscpIgpaJ9cuvf5t0i67OeQCg';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentUser = null;
        let isAdmin = false;
        
        // í•œêµ­ ì‹œê°„(KST) ê¸°ì¤€ìœ¼ë¡œ ì˜¤ëŠ˜ ë‚ ì§œ ë°˜í™˜ (YYYY-MM-DD)
        function getTodayKST() {
            const now = new Date();
            // UTC ì‹œê°„ì— 9ì‹œê°„(í•œêµ­ ì‹œê°„ëŒ€)ì„ ë”í•¨
            const kstOffset = 9 * 60; // 9ì‹œê°„ì„ ë¶„ìœ¼ë¡œ ë³€í™˜
            const kstTime = new Date(now.getTime() + (kstOffset * 60 * 1000));
            
            // ISO ë¬¸ìì—´ë¡œ ë³€í™˜ í›„ ë‚ ì§œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
            return kstTime.toISOString().split('T')[0];
        }
        
        // UTC ì‹œê°„ì„ í•œêµ­ ì‹œê°„(KST)ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ í¬ë§·íŒ…
        function formatDateKST(utcDateStr, format = 'date') {
            if (!utcDateStr) return 'ì—†ìŒ';
            const utcDate = new Date(utcDateStr);
            const kstDate = new Date(utcDate.getTime() + (9 * 60 * 60 * 1000));
            
            const year = kstDate.getUTCFullYear();
            const month = kstDate.getUTCMonth() + 1;
            const day = kstDate.getUTCDate();
            
            if (format === 'full') {
                return `${year}.${month}.${day}`;
            } else if (format === 'short') {
                return `${month}/${day}`;
            } else {
                return `${year}. ${month}. ${day}.`;
            }
        }
        
        // Realtime ì±„ë„ ë³€ìˆ˜
        let realtimeChannel = null;
        
        // Realtime êµ¬ë… ì‹œì‘ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸, Egress 95% ì ˆê°)
        function startRealtimeSubscription() {
            // ê¸°ì¡´ ì±„ë„ ì œê±°
            if (realtimeChannel) {
                supabase.removeChannel(realtimeChannel);
            }
            
            // Realtime ì±„ë„ êµ¬ë… (game_stats + daily_sessions)
            realtimeChannel = supabase
                .channel(`user_stats_${currentUser}`)
                // 1. ì „ì²´ í†µê³„ (ì‹¤ì‹œê°„ ì •ë³´)
                .on('postgres_changes', {
                    event: 'UPDATE',
                    schema: 'public',
                    table: 'game_stats',
                    filter: `username=eq.${currentUser}`
                }, (payload) => {
                    console.log('ğŸ”” ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (ì „ì²´ í†µê³„):', payload.new);
                    updateStatsDisplay(payload.new);
                })
                // 2. ì˜¤ëŠ˜ì˜ í†µê³„ (ì¼ì¼ ì„¸ì…˜)
                .on('postgres_changes', {
                    event: '*',  // INSERT, UPDATE ëª¨ë‘
                    schema: 'public',
                    table: 'daily_sessions',
                    filter: `username=eq.${currentUser}`
                }, (payload) => {
                    console.log('ğŸ”” ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (ì˜¤ëŠ˜ì˜ í†µê³„):', payload.new);
                    updateDailySessionDisplay(payload.new);
                })
                .subscribe((status) => {
                    if (status === 'SUBSCRIBED') {
                        console.log('âœ… Realtime ì—°ê²° ì„±ê³µ! (ì „ì²´ í†µê³„ + ì˜¤ëŠ˜ì˜ í†µê³„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)');
                    } else if (status === 'CLOSED') {
                        console.log('âŒ Realtime ì—°ê²° ëŠê¹€. 5ì´ˆ í›„ ì¬ì—°ê²°...');
                        setTimeout(() => startRealtimeSubscription(), 5000);
                    } else if (status === 'CHANNEL_ERROR') {
                        console.log('âš ï¸ Realtime ì—°ê²° ì˜¤ë¥˜. 10ì´ˆ í›„ ì¬ì—°ê²°...');
                        setTimeout(() => startRealtimeSubscription(), 10000);
                    }
                });
            
            console.log('ğŸ”” Realtime êµ¬ë… ì‹œì‘ (ì „ì²´ í†µê³„ + ì˜¤ëŠ˜ì˜ í†µê³„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸, Egress 95% ì ˆê°)');
        }
        
        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™”ë©´ ë°˜ì˜ (ì „ì²´ í†µê³„)
        function updateStatsDisplay(data) {
            // ì‹¤ì‹œê°„ ì •ë³´ ì—…ë°ì´íŠ¸
            if (data.wins !== undefined) {
                document.getElementById('sessionWins').textContent = data.wins + 'ìŠ¹';
            }
            if (data.losses !== undefined) {
                document.getElementById('sessionLosses').textContent = data.losses + 'íŒ¨';
            }
            if (data.draws !== undefined) {
                document.getElementById('sessionDraws').textContent = data.draws + 'ë¬´';
            }
            if (data.matches !== undefined) {
                document.getElementById('sessionMatches').textContent = data.matches + 'íŒ';
            }
            if (data.fc_mined !== undefined) {
                document.getElementById('sessionFC').textContent = data.fc_mined + ' FC';
            }
            if (data.current_score !== undefined) {
                document.getElementById('currentScore').textContent = data.current_score;
            }
            if (data.current_rank !== undefined) {
                document.getElementById('currentRank').textContent = data.current_rank + 'ìœ„';
            }
            if (data.current_tier !== undefined) {
                document.getElementById('currentTier').textContent = data.current_tier;
            }
            if (data.game_status !== undefined) {
                document.getElementById('gameStatus').textContent = data.game_status;
            }
            
            // ìºì‹œ ì—…ë°ì´íŠ¸ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ ì‚¬ìš©)
            cachedStats = data;
            lastStatsLoad = Date.now();
            
            console.log('âœ¨ ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (Realtime)');
        }
        
        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™”ë©´ ë°˜ì˜ (ì˜¤ëŠ˜ì˜ í†µê³„)
        function updateDailySessionDisplay(data) {
            const today = getTodayKST();
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
            if (data.session_date === today) {
                if (data.start_score !== undefined) {
                    document.getElementById('todayStartScore').textContent = data.start_score;
                }
                if (data.highest_score !== undefined) {
                    document.getElementById('todayHighestScore').textContent = data.highest_score;
                }
                if (data.wins !== undefined) {
                    document.getElementById('todayWins').textContent = data.wins + 'ìŠ¹';
                }
                if (data.losses !== undefined) {
                    document.getElementById('todayLosses').textContent = data.losses + 'íŒ¨';
                }
                if (data.draws !== undefined) {
                    document.getElementById('todayDraws').textContent = data.draws + 'ë¬´';
                }
                if (data.matches !== undefined) {
                    document.getElementById('todayMatches').textContent = data.matches + 'íŒ';
                }
                if (data.fc_mined !== undefined) {
                    document.getElementById('todayFC').textContent = data.fc_mined + ' FC';
                }
                
                // ìºì‹œ ì—…ë°ì´íŠ¸
                cachedDailySession = data;
                lastDailySessionLoad = Date.now();
                
                console.log('âœ¨ ì˜¤ëŠ˜ì˜ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (Realtime)');
            }
        }
        
        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ (F5 ëˆ„ë¥´ë©´ ê°•ì œë¡œ Supabaseì—ì„œ ê°€ì ¸ì˜¤ê¸°)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F5' && currentUser) {
                e.preventDefault();
                loadMyStats(true); // forceRefresh = true
                
                // í˜„ì¬ í™œì„± íƒ­ë„ ê°•ì œ ìƒˆë¡œê³ ì¹¨ (forceRefresh = true)
                if (document.getElementById('weekTab').classList.contains('active')) {
                    loadWeekStats(true);
                } else if (document.getElementById('rankingTab').classList.contains('active')) {
                    loadRanking(true);
                    // ë­í‚¹ íƒ­ ë‚´ë¶€ì˜ ì„œë¸Œ íƒ­ë„ ìƒˆë¡œê³ ì¹¨
                    const rankingType = document.querySelector('.ranking-type-btn.active')?.textContent;
                    if (rankingType && rankingType.includes('ì ìˆ˜')) {
                        loadScoreRanking(true);
                    } else if (rankingType && rankingType.includes('ìµœë‹¤ìŠ¹')) {
                        loadWinsRanking(true);
                    }
                }
                console.log('ğŸ”„ ê°•ì œ ìƒˆë¡œê³ ì¹¨ (F5) - ëª¨ë“  ìºì‹œ ë¬´ì‹œ');
            }
        });
        
        // Realtime êµ¬ë… ì¤‘ì§€
        function stopRealtimeSubscription() {
            if (realtimeChannel) {
                supabase.removeChannel(realtimeChannel);
                realtimeChannel = null;
                console.log('ğŸ”• Realtime êµ¬ë… ì¤‘ì§€');
            }
        }
        
        // ìë™ ë¡œê·¸ì¸ ì²´í¬
        window.onload = function() {
            const savedUsername = localStorage.getItem('function_username');
            const savedPassword = localStorage.getItem('function_password');
            
            if (savedUsername && savedPassword) {
                document.getElementById('loginUsername').value = savedUsername;
                document.getElementById('loginPassword').value = savedPassword;
                document.getElementById('autoLoginCheck').checked = true;
                login(true); // ìë™ ë¡œê·¸ì¸
            }
        };
        
        // ë¡œê·¸ì¸/íšŒì›ê°€ì… í¼ ì „í™˜
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('showLoginBtn').style.background = '#1f6feb';
            document.getElementById('showSignupBtn').style.background = '#30363d';
            document.getElementById('loginMessage').innerHTML = '';
        }
        
        function showSignupForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
            document.getElementById('showLoginBtn').style.background = '#30363d';
            document.getElementById('showSignupBtn').style.background = '#1f6feb';
            document.getElementById('loginMessage').innerHTML = '';
        }
        
        // íšŒì›ê°€ì…
        async function signup() {
            const username = document.getElementById('signupUsername').value.trim();
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            
            if (!username || !password || !passwordConfirm) {
                showLoginMessage('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                showLoginMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ì‚¬ìš©ìëª… ê²€ì¦ (2-20ì, í•œê¸€/ì˜ì–´/ìˆ«ìë§Œ)
            if (username.length < 2 || username.length > 20) {
                showLoginMessage('ì‚¬ìš©ìëª…ì€ 2~20ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            const usernameRegex = /^[ê°€-í£a-zA-Z0-9]+$/;
            if (!usernameRegex.test(username)) {
                showLoginMessage('ì‚¬ìš©ìëª…ì€ í•œê¸€, ì˜ì–´, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (6-12ì, ì˜ì–´/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ê°€ì§€ ì´ìƒ)
            if (password.length < 6 || password.length > 12) {
                showLoginMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” 6~12ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            const complexityCount = [hasLetter, hasNumber, hasSpecial].filter(Boolean).length;
            
            if (complexityCount < 2) {
                showLoginMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ì–´, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ê°€ì§€ ì´ìƒ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                // Supabase RPCë¥¼ í†µí•œ íšŒì›ê°€ì…
                const { data, error } = await supabase.rpc('signup_user', {
                    username_param: username,
                    pin_param: password
                });
                
                if (error) {
                    if (error.message.includes('ì´ë¯¸ ì¡´ì¬')) {
                        showLoginMessage('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.', 'error');
                    } else {
                        showLoginMessage('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message, 'error');
                    }
                    return;
                }
                
                showLoginMessage('âœ… íšŒì›ê°€ì… ì„±ê³µ! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
                
                // 3ì´ˆ í›„ ë¡œê·¸ì¸ í¼ìœ¼ë¡œ ì „í™˜
                setTimeout(() => {
                    showLoginForm();
                    document.getElementById('signupUsername').value = '';
                    document.getElementById('signupPassword').value = '';
                    document.getElementById('signupPasswordConfirm').value = '';
                }, 3000);
                
            } catch (error) {
                showLoginMessage('íšŒì›ê°€ì… ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        // ë¡œê·¸ì¸
        async function login(auto = false) {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const autoLogin = document.getElementById('autoLoginCheck').checked;
            
            if (!username || !password) {
                if (!auto) showLoginMessage('ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const { data: userData, error: userError } = await supabase
                    .from('user_accounts')
                    .select('*')
                    .eq('username', username)
                    .single();
                
                if (userError || !userData) {
                    if (!auto) showLoginMessage('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    if (auto) clearAutoLogin();
                    return;
                }
                
                if (userData.status !== 'approved') {
                    if (!auto) showLoginMessage('ê³„ì •ì´ ìŠ¹ì¸ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                    if (auto) clearAutoLogin();
                    return;
                }
                
                const { data: pinValid, error: pinError } = await supabase.rpc('verify_pin', {
                    username_param: username,
                    pin_param: password
                });
                
                if (pinError || !pinValid) {
                    if (!auto) showLoginMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    if (auto) clearAutoLogin();
                    return;
                }
                
                // ë¡œê·¸ì¸ ì„±ê³µ!
                currentUser = userData.username;
                isAdmin = userData.is_admin || false;
                
                // ìë™ ë¡œê·¸ì¸ ì €ì¥
                if (autoLogin) {
                    localStorage.setItem('function_username', username);
                    localStorage.setItem('function_password', password);
                } else {
                    clearAutoLogin();
                }
                
                // ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì—…ë°ì´íŠ¸
                await supabase.from('user_accounts').update({
                    last_login: new Date().toISOString()
                }).eq('username', username);
                
                showMainView();
                
            } catch (error) {
                if (!auto) showLoginMessage('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        function clearAutoLogin() {
            localStorage.removeItem('function_username');
            localStorage.removeItem('function_password');
        }
        
        function showLoginMessage(msg, type) {
            const msgDiv = document.getElementById('loginMessage');
            msgDiv.className = `message ${type}`;
            msgDiv.textContent = msg;
        }
        
        function showMainView() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainView').classList.add('active');
            
            document.getElementById('headerUsername').textContent = currentUser;
            
            if (isAdmin) {
                document.getElementById('adminBadge').style.display = 'inline';
                document.getElementById('adminTabBtn').style.display = 'block';
                document.getElementById('updateWriteForm').style.display = 'block';
                document.getElementById('announcementAdmin').style.display = 'block';  // ê³µì§€ ì‘ì„± í‘œì‹œ
            }
            
            // ì´ˆê¸° ë¡œë“œ ìµœì†Œí™”: ì˜¤ëŠ˜ íƒ­ë§Œ ë¡œë“œí•˜ê³  ë‚˜ë¨¸ì§€ëŠ” íƒ­ í´ë¦­ ì‹œ ë¡œë“œ (Lazy Loading)
            // Realtimeì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ ì´ˆê¸° ë¡œë“œ ë¶ˆí•„ìš”
            loadAnnouncements();  // ê³µì§€ì‚¬í•­ ë¡œë“œ (í•„ìˆ˜)
            loadMyStats(); // ì˜¤ëŠ˜ íƒ­ë§Œ ë¡œë“œ (ê¸°ë³¸ íƒ­)
            
            // Realtime êµ¬ë… ì‹œì‘ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¡œ ìë™ ë°˜ì˜ë˜ë¯€ë¡œ ì´ˆê¸° ë¡œë“œ ë¶ˆí•„ìš”)
            startRealtimeSubscription();
            console.log('ğŸ”” Realtime í™œì„±í™”: í”„ë¡œê·¸ë¨ ë³€ê²½ì‚¬í•­ì´ 0.1ì´ˆë§Œì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤!');
        }
        
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // Realtime êµ¬ë… ì¤‘ì§€
                stopRealtimeSubscription();
                
                // ëª¨ë“  ìºì‹œ ì´ˆê¸°í™” (Egress ìµœì í™”)
                cachedStats = null;
                cachedDailySession = null;
                cachedRanking = null;
                cachedScoreRanking = null;
                cachedWinsRanking = null;
                cachedWeekStats = null;
                lastStatsLoad = 0;
                lastDailySessionLoad = 0;
                lastRankingLoad = 0;
                lastScoreRankingLoad = 0;
                lastWinsRankingLoad = 0;
                lastWeekStatsLoad = 0;
                
                clearAutoLogin();
                currentUser = null;
                isAdmin = false;
                document.getElementById('loginContainer').style.display = 'block';
                document.getElementById('mainView').classList.remove('active');
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginMessage').innerHTML = '';
            }
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tabName === 'today') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('todayTab').classList.add('active');
                loadMyStats();
            } else if (tabName === 'week') {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('weekTab').classList.add('active');
                loadWeekStats();
            } else if (tabName === 'history') {
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                document.getElementById('historyTab').classList.add('active');
                loadScoreGraph(300);
            } else if (tabName === 'ranking') {
                document.querySelectorAll('.tab-btn')[3].classList.add('active');
                document.getElementById('rankingTab').classList.add('active');
                loadRanking();
            } else if (tabName === 'updates') {
                document.querySelectorAll('.tab-btn')[4].classList.add('active');
                document.getElementById('updatesTab').classList.add('active');
                loadUpdates(); // Lazy Loading: íƒ­ í´ë¦­ ì‹œì—ë§Œ ë¡œë“œ
            } else if (tabName === 'admin' && isAdmin) {
                document.getElementById('adminTabBtn').classList.add('active');
                document.getElementById('adminTab').classList.add('active');
                loadAdminPanel(); // Lazy Loading: íƒ­ í´ë¦­ ì‹œì—ë§Œ ë¡œë“œ
            }
        }
        
        // ìºì‹± ë³€ìˆ˜ (Egress ì ˆê°)
        let cachedStats = null;
        let cachedDailySession = null;
        let cachedRanking = null;
        let cachedScoreRanking = null;
        let cachedWinsRanking = null;
        let cachedWeekStats = null;
        let lastStatsLoad = 0;
        let lastDailySessionLoad = 0;
        let lastRankingLoad = 0;
        let lastScoreRankingLoad = 0;
        let lastWinsRankingLoad = 0;
        let lastWeekStatsLoad = 0;
        const CACHE_TIME = 300000; // 5ë¶„ ìºì‹œ (Egress ì ˆê° ìµœì í™”)
        const RANKING_CACHE_TIME = 300000; // ë­í‚¹ë„ 5ë¶„ ìºì‹œ
        let isAutoRefreshStarted = false; // ìë™ ê°±ì‹  ì‹œì‘ ì—¬ë¶€
        
        // ë‚´ í†µê³„ ë¡œë“œ (ì‹¤ì‹œê°„ ì •ë³´ í¬í•¨) - ìºì‹± ì ìš©
        async function loadMyStats(forceRefresh = false) {
            const now = Date.now();
            
            // Realtimeì€ ë¡œê·¸ì¸ ì‹œ ìë™ ì‹œì‘ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ë¶ˆí•„ìš”
            
            // ì „ì²´ í†µê³„ ë¡œë“œ (ì‹¤ì‹œê°„ ì •ë³´ìš©) - 3ë¶„ ìºì‹± (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ)
            let stats = cachedStats;
            if (forceRefresh || !cachedStats || now - lastStatsLoad > CACHE_TIME) {
                const { data: freshStats } = await supabase
                    .from('game_stats')
                    .select('current_score, current_rank, current_tier, wins, draws, losses, fc_mined, matches, active_modes')
                    .eq('username', currentUser)
                    .single();
                stats = freshStats;
                cachedStats = freshStats;
                lastStatsLoad = now;
            }
            
            if (stats) {
                // ì‹¤ì‹œê°„ ë¯¸ë‹ˆì°½ ì •ë³´ (í˜„ì¬ ê°’ í‘œì‹œ) - 5ìë¦¬ ì´ìƒ í•„í„°ë§
                const score = Number(stats.current_score);
                const displayScore = (score && score > 0 && score < 10000) ? score : '--';
                document.getElementById('liveScore').textContent = displayScore;
                
                // ë“±ìˆ˜ í‘œì‹œ (ìˆœìœ„ê¶Œì´íƒˆ í¬í•¨)
                const rankElement = document.getElementById('liveRank');
                if (stats.current_rank && stats.current_rank < 99999) {
                    rankElement.textContent = stats.current_rank;
                    rankElement.style.fontSize = '20px';
                } else if (stats.current_rank >= 99999) {
                    rankElement.textContent = 'ìˆœìœ„ê¶Œì´íƒˆ';
                    rankElement.style.fontSize = '12px';
                } else {
                    rankElement.textContent = '--';
                    rankElement.style.fontSize = '20px';
                }
                
                document.getElementById('liveTier').textContent = stats.current_tier || '--';
                document.getElementById('liveWLD').textContent = `${stats.wins || 0}-${stats.draws || 0}-${stats.losses || 0}`;
                document.getElementById('liveFC').textContent = stats.fc_mined || 0;
                document.getElementById('liveMatches').textContent = stats.matches || 0;
                
                // ê²Œì„ ìƒíƒœ í‘œì‹œ ì œê±° (í™œì„± ëª¨ë“œë§Œ í‘œì‹œ)
                // const status = stats.game_status || 'ëŒ€ê¸° ì¤‘';
                // document.getElementById('liveStatus').textContent = status;
                
                // í™œì„± ëª¨ë“œ íƒœê·¸ í‘œì‹œ
                const tagsContainer = document.getElementById('liveTags');
                const activeModes = stats.active_modes ? stats.active_modes.split(',').filter(m => m.trim()) : [];
                
                if (activeModes.length > 0) {
                    tagsContainer.innerHTML = activeModes.map(mode => 
                        `<span class="mini-tag">${mode}</span>`
                    ).join('');
                } else {
                    tagsContainer.innerHTML = '';
                }
            }
            
            // ì˜¤ëŠ˜ì˜ í†µê³„ ë¡œë“œ (í•œêµ­ ì‹œê°„ ê¸°ì¤€) - 3ë¶„ ìºì‹± (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ)
            const today = getTodayKST();
            let todaySession = cachedDailySession;
            if (forceRefresh || !cachedDailySession || now - lastDailySessionLoad > CACHE_TIME) {
                const { data: freshSession } = await supabase
                    .from('daily_sessions')
                    .select('wins, losses, draws, matches, fc_mined, start_score, highest_score')
                    .eq('username', currentUser)
                    .eq('session_date', today)
                    .single();
                todaySession = freshSession;
                cachedDailySession = freshSession;
                lastDailySessionLoad = now;
            }
            
            if (todaySession) {
                document.getElementById('todayWins').textContent = todaySession.wins || 0;
                document.getElementById('todayLosses').textContent = todaySession.losses || 0;
                document.getElementById('todayDraws').textContent = todaySession.draws || 0;
                document.getElementById('todayMatches').textContent = todaySession.matches || 0;
                document.getElementById('todayFC').textContent = todaySession.fc_mined || 0;
                document.getElementById('todayStartScore').textContent = todaySession.start_score || '--';
                document.getElementById('todayHighScore').textContent = todaySession.highest_score || '--';
                
                const total = (todaySession.wins || 0) + (todaySession.losses || 0) + (todaySession.draws || 0);
                const winrate = total > 0 ? ((todaySession.wins || 0) / total * 100).toFixed(1) : 0;
                document.getElementById('todayWinrate').textContent = winrate + '%';
            }
            
            // ìŠ¹ê¸‰ ì •ë³´ ë¡œë“œ
            await loadPromotionInfo();
        }
        
        // ìµœê·¼ 7ì¼ í†µê³„ ë¡œë“œ (í•œêµ­ ì‹œê°„ ê¸°ì¤€) (Egress ìµœì í™”: ìºì‹± ì¶”ê°€)
        async function loadWeekStats(forceRefresh = false) {
            const now = Date.now();
            let weekData = cachedWeekStats;
            let promotions = null;
            
            if (forceRefresh || !cachedWeekStats || now - lastWeekStatsLoad > CACHE_TIME) {
                // í•œêµ­ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ 7ì¼ ì „ ë‚ ì§œ ê³„ì‚°
                const dateNow = new Date();
                const kstOffset = 9 * 60 * 60 * 1000; // 9ì‹œê°„ì„ ë°€ë¦¬ì´ˆë¡œ
                const kstNow = new Date(dateNow.getTime() + kstOffset);
                kstNow.setDate(kstNow.getDate() - 7);
                const sevenDaysAgo = kstNow.toISOString().split('T')[0];
                
                const { data: freshWeekData } = await supabase
                    .from('daily_sessions')
                    .select('session_date, wins, losses, draws, fc_mined')
                    .eq('username', currentUser)
                    .gte('session_date', sevenDaysAgo)
                    .order('session_date', { ascending: false });
                weekData = freshWeekData;
                cachedWeekStats = freshWeekData;
                lastWeekStatsLoad = now;
                
                // ìŠˆì±Œâ†’ì±”ìŠ¤ ìŠ¹ê¸‰ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (í•œêµ­ ì‹œê°„ ê¸°ì¤€) (Egress ìµœì í™”)
                const { data: freshPromotions } = await supabase
                .from('tier_promotions')
                    .select('promoted_at, matches_taken')
                    .eq('username', currentUser)
                    .eq('from_tier', 'ìŠˆì±Œ')
                    .eq('to_tier', 'ì±”ìŠ¤')
                    .gte('promoted_at', sevenDaysAgo)
                    .order('promoted_at', { ascending: false });
                promotions = freshPromotions;
            }
            
            const tbody = document.getElementById('weekTableBody');
            
            if (!weekData || weekData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#8b949e;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }
            
            // ë‚ ì§œë³„ ìŠ¹ê¸‰ ì •ë³´ ë§¤í•‘
            const promotionMap = {};
            if (promotions) {
                promotions.forEach(p => {
                    const date = p.promoted_at.split('T')[0];
                    promotionMap[date] = p.matches_taken;
                });
            }
            
            // í‘œ ì±„ìš°ê¸°
            let html = '';
            weekData.forEach(day => {
                // í•œêµ­ ì‹œê°„ìœ¼ë¡œ ë‚ ì§œ í‘œì‹œ
                const dateStr = formatDateKST(day.session_date, 'short');
                
                const wins = day.wins || 0;
                const losses = day.losses || 0;
                const draws = day.draws || 0;
                const total = wins + losses + draws;
                const winrate = total > 0 ? ((wins / total) * 100).toFixed(1) : '0.0';
                const fc = day.fc_mined || 0;
                
                const promotion = promotionMap[day.session_date];
                const promotionText = promotion ? `${promotion}íŒ` : '--';
                
                html += `
                    <tr>
                        <td style="color: #b4b4b4;">${dateStr}</td>
                        <td style="color: #86efac; font-weight: 600;">${wins}</td>
                        <td style="color: #fcd34d; font-weight: 600;">${draws}</td>
                        <td style="color: #fca5a5; font-weight: 600;">${losses}</td>
                        <td style="color: #e0e0e0; font-weight: 600;">${winrate}%</td>
                        <td style="color: #fdba74; font-weight: 600;">${fc}</td>
                        <td style="color: #c4b5fd; font-weight: 600;">${promotionText}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // ìŠˆì±Œâ†’ì±”ìŠ¤ ìŠ¹ê¸‰ ì •ë³´ ë¡œë“œ (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ)
        async function loadPromotionInfo() {
            const { data: promotion } = await supabase
                .from('tier_promotions')
                .select('promoted_at, matches_taken')
                .eq('username', currentUser)
                .eq('from_tier', 'ìŠˆì±Œ')
                .eq('to_tier', 'ì±”ìŠ¤')
                .order('promoted_at', { ascending: false })
                .limit(1)
                .single();
            
            if (promotion) {
                document.getElementById('promotionCard').style.display = 'block';
                document.getElementById('promotionMatches').textContent = `${promotion.matches_taken || '--'}íŒ`;
                
                // í•œêµ­ ì‹œê°„ìœ¼ë¡œ ë‚ ì§œ í‘œì‹œ
                const dateStr = formatDateKST(promotion.promoted_at, 'full');
                document.getElementById('promotionDate').textContent = `${dateStr} ìŠ¹ê¸‰`;
            } else {
                document.getElementById('promotionCard').style.display = 'none';
            }
        }
        
        // ìµœê·¼ Nê²½ê¸° ì ìˆ˜ ê·¸ë˜í”„ (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ)
        async function loadScoreGraph(limit) {
            const { data: history } = await supabase
                .from('game_history')
                .select('created_at, score, result')
                .eq('username', currentUser)
                .order('created_at', { ascending: false })
                .limit(limit);
            
            if (!history || history.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë¹ˆ ê·¸ë˜í”„ í‘œì‹œ
                const scoreCtx = document.getElementById('scoreChart').getContext('2d');
                if (window.scoreChart) window.scoreChart.destroy();
                window.scoreChart = new Chart(scoreCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'ì ìˆ˜',
                            data: [],
                            borderColor: '#94a3b8',
                            backgroundColor: 'rgba(148, 163, 184, 0.1)',
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'ì•„ì§ ê²½ê¸° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤',
                                color: '#8b949e'
                            }
                        }
                    }
                });
                return;
            }
            
            // ìµœì‹  ê²½ê¸°ê°€ ì˜¤ë¥¸ìª½ì— ì˜¤ë„ë¡ ì—­ìˆœ ì •ë ¬
            history.reverse();
            
            // ì‹¤ì œ ì ìˆ˜ ì¶”ì¶œ
            const scores = [];
            const labels = [];
            let gameNumber = 1;
            
            history.forEach((game) => {
                // score_afterê°€ ìˆìœ¼ë©´ ì‹¤ì œ ì ìˆ˜, ì—†ìœ¼ë©´ ìŠ¤í‚µ
                if (game.score_after) {
                    scores.push(game.score_after);
                    labels.push(gameNumber.toString());
                    gameNumber++;
                }
            });
            
            if (scores.length === 0) {
                // score_after ë°ì´í„°ê°€ ì—†ì„ ë•Œ
                const scoreCtx = document.getElementById('scoreChart').getContext('2d');
                if (window.scoreChart) window.scoreChart.destroy();
                window.scoreChart = new Chart(scoreCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'ì ìˆ˜',
                            data: [],
                            borderColor: '#94a3b8',
                            backgroundColor: 'rgba(148, 163, 184, 0.1)',
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'ì ìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤ (í”„ë¡œê·¸ë¨ì„ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”)',
                                color: '#f85149'
                            }
                        }
                    }
                });
                return;
            }
            
            // ì ìˆ˜ ê·¸ë˜í”„
            const scoreCtx = document.getElementById('scoreChart').getContext('2d');
            try { if (window.scoreChart) window.scoreChart.destroy(); } catch(e) {}
            window.scoreChart = new Chart(scoreCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì ìˆ˜',
                        data: scores,
                        borderColor: '#58a6ff',
                        backgroundColor: 'rgba(88, 166, 255, 0.1)',
                        tension: 0.3,
                        fill: true,
                        pointRadius: 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ì ìˆ˜: ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ê²½ê¸°',
                                color: '#8b949e',
                                font: { size: 12 }
                            },
                            ticks: { 
                                color: '#8b949e', 
                                maxTicksLimit: 20
                            },
                            grid: { color: '#30363d' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ì ìˆ˜',
                                color: '#8b949e',
                                font: { size: 12 }
                            },
                            ticks: { 
                                color: '#8b949e',
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: { color: '#30363d' }
                        }
                    }
                }
            });
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.textContent.includes(limit + 'ê²½ê¸°')) {
                    btn.classList.add('active');
                } else if (btn.textContent.includes('ê²½ê¸°')) {
                    btn.classList.remove('active');
                }
            });
        }
        
        // ë­í‚¹ ë¡œë“œ (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ + ìºì‹±)
        async function loadRanking(forceRefresh = false) {
            const now = Date.now();
            let rankings = cachedRanking;
            
            if (forceRefresh || !cachedRanking || now - lastRankingLoad > RANKING_CACHE_TIME) {
                const { data: freshRankings } = await supabase
                    .from('game_stats')
                    .select('username, wins, losses, draws')
                    .order('wins', { ascending: false })
                    .limit(30);
                rankings = freshRankings;
                cachedRanking = freshRankings;
                lastRankingLoad = now;
            }
            
            const tbody = document.getElementById('rankingBody');
            tbody.innerHTML = '';
            
            if (rankings && rankings.length > 0) {
                rankings.forEach((rank, index) => {
                    const total = (rank.wins || 0) + (rank.losses || 0) + (rank.draws || 0);
                    const winrate = total > 0 ? ((rank.wins || 0) / total * 100).toFixed(1) : 0;
                    const isMe = rank.username === currentUser;
                    
                    let rankClass = '';
                    if (index === 0) rankClass = 'rank-1';
                    else if (index === 1) rankClass = 'rank-2';
                    else if (index === 2) rankClass = 'rank-3';
                    
                    tbody.innerHTML += `
                        <tr class="${rankClass} ${isMe ? 'me-row' : ''}">
                            <td>${index + 1}${index < 3 ? 'ğŸ†' : ''}</td>
                            <td><strong>${rank.username}</strong>${isMe ? ' (ë‚˜)' : ''}</td>
                            <td>${rank.wins || 0}</td>
                            <td>${rank.losses || 0}</td>
                            <td>${rank.draws || 0}</td>
                            <td>${winrate}%</td>
                        </tr>
                    `;
                });
            }
        }
        
        // ê´€ë¦¬ì íŒ¨ë„ (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ)
        async function loadAdminPanel() {
            const { data: users } = await supabase.from('user_accounts')
                .select('username, status, created_at, last_login, is_admin');
            
            if (users) {
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('pendingUsers').textContent = users.filter(u => u.status === 'pending').length;
                document.getElementById('approvedUsers').textContent = users.filter(u => u.status === 'approved').length;
                
                const today = getTodayKST();
                const activeToday = users.filter(u => u.last_login && u.last_login.startsWith(today)).length;
                document.getElementById('activeToday').textContent = activeToday;
                
                // ìŠ¹ì¸ ëŒ€ê¸°
                const pendingBody = document.getElementById('pendingUsersBody');
                pendingBody.innerHTML = '';
                const pending = users.filter(u => u.status === 'pending');
                
                if (pending.length === 0) {
                    pendingBody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#8b949e;">ì—†ìŒ</td></tr>';
                } else {
                    pending.forEach(user => {
                        const createdDate = formatDateKST(user.created_at);
                        pendingBody.innerHTML += `
                            <tr>
                                <td><strong>${user.username}</strong></td>
                                <td>${createdDate}</td>
                                <td class="action-buttons">
                                    <button class="btn-approve" onclick="approveUser('${user.username}')">âœ“</button>
                                    <button class="btn-reject" onclick="rejectUser('${user.username}')">âœ—</button>
                                </td>
                            </tr>
                        `;
                    });
                }
                
                // ìŠ¹ì¸ëœ íšŒì›
                const approvedBody = document.getElementById('approvedUsersBody');
                approvedBody.innerHTML = '';
                const approved = users.filter(u => u.status === 'approved');
                
                approved.forEach(user => {
                    const lastLogin = formatDateKST(user.last_login);
                    approvedBody.innerHTML += `
                        <tr>
                            <td><strong>${user.username}</strong>${user.is_admin ? ' ğŸ‘‘' : ''}</td>
                            <td>${lastLogin}</td>
                            <td class="action-buttons">
                                ${!user.is_admin ? `
                                    <button class="btn-suspend" onclick="suspendUser('${user.username}')">â¸</button>
                                    <button class="btn-delete" onclick="deleteUser('${user.username}')">ğŸ—‘</button>
                                ` : '<span style="color:#8b949e;">ê´€ë¦¬ì</span>'}
                            </td>
                        </tr>
                    `;
                });
                
                // ì •ì§€ëœ íšŒì›
                const suspendedBody = document.getElementById('suspendedUsersBody');
                suspendedBody.innerHTML = '';
                const suspended = users.filter(u => u.status === 'suspended');
                
                if (suspended.length === 0) {
                    suspendedBody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#8b949e;">ì—†ìŒ</td></tr>';
                } else {
                    suspended.forEach(user => {
                        const suspendedDate = formatDateKST(user.updated_at);
                        suspendedBody.innerHTML += `
                            <tr>
                                <td><strong>${user.username}</strong></td>
                                <td>${suspendedDate}</td>
                                <td class="action-buttons">
                                    <button class="btn-approve" onclick="restoreUser('${user.username}')">âœ“ ë³µê·€</button>
                                    <button class="btn-delete" onclick="deleteUser('${user.username}')">ğŸ—‘</button>
                                </td>
                            </tr>
                        `;
                    });
                }
                
                // ê±°ë¶€ëœ íšŒì›
                const rejectedBody = document.getElementById('rejectedUsersBody');
                rejectedBody.innerHTML = '';
                const rejected = users.filter(u => u.status === 'rejected');
                
                if (rejected.length === 0) {
                    rejectedBody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#8b949e;">ì—†ìŒ</td></tr>';
                } else {
                    rejected.forEach(user => {
                        const rejectedDate = formatDateKST(user.updated_at);
                        rejectedBody.innerHTML += `
                            <tr>
                                <td><strong>${user.username}</strong></td>
                                <td>${rejectedDate}</td>
                                <td class="action-buttons">
                                    <button class="btn-approve" onclick="restoreUser('${user.username}')">âœ“ ë³µê·€</button>
                                    <button class="btn-delete" onclick="deleteUser('${user.username}')">ğŸ—‘</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            }
        }
        
        async function approveUser(username) {
            if (!confirm(`'${username}' ìŠ¹ì¸?`)) return;
            
            try {
                const { data, error } = await supabase.from('user_accounts').update({
                    status: 'approved',
                    approved_at: new Date().toISOString(),
                    approved_by: currentUser
                }).eq('username', username);
                
                if (error) throw error;
                
                alert('âœ… ìŠ¹ì¸ ì™„ë£Œ!');
                await loadAdminPanel(); // await ì¶”ê°€
                
            } catch (error) {
                console.error('ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                alert('âŒ ìŠ¹ì¸ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        async function rejectUser(username) {
            if (!confirm(`'${username}' ê±°ë¶€?`)) return;
            
            try {
                const { error } = await supabase.from('user_accounts').update({ 
                    status: 'rejected' 
                }).eq('username', username);
                
                if (error) throw error;
                
                alert('âœ… ê±°ë¶€ ì™„ë£Œ');
                await loadAdminPanel();
                
            } catch (error) {
                console.error('ê±°ë¶€ ì˜¤ë¥˜:', error);
                alert('âŒ ê±°ë¶€ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        async function suspendUser(username) {
            if (!confirm(`'${username}' ì •ì§€?`)) return;
            
            try {
                const { error } = await supabase.from('user_accounts').update({ 
                    status: 'suspended' 
                }).eq('username', username);
                
                if (error) throw error;
                
                alert('âœ… ì •ì§€ ì™„ë£Œ');
                await loadAdminPanel();
                
            } catch (error) {
                console.error('ì •ì§€ ì˜¤ë¥˜:', error);
                alert('âŒ ì •ì§€ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        async function deleteUser(username) {
            if (!confirm(`'${username}' ì‚­ì œ?\ní†µê³„ë„ ì‚­ì œë©ë‹ˆë‹¤!`)) return;
            
            try {
                // í†µê³„ ì‚­ì œ
                const { error: statsError } = await supabase.from('game_stats').delete().eq('username', username);
                if (statsError) throw statsError;
                
                // ê³„ì • ì‚­ì œ
                const { error: userError } = await supabase.from('user_accounts').delete().eq('username', username);
                if (userError) throw userError;
                
                alert('âœ… ì‚­ì œ ì™„ë£Œ');
                await loadAdminPanel();
                
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        async function restoreUser(username) {
            if (!confirm(`'${username}' ë³µê·€ (ìŠ¹ì¸ ìƒíƒœë¡œ ë³€ê²½)?`)) return;
            
            try {
                const { error } = await supabase.from('user_accounts').update({
                    status: 'approved',
                    approved_at: new Date().toISOString(),
                    approved_by: currentUser
                }).eq('username', username);
                
                if (error) throw error;
                
                alert('âœ… ë³µê·€ ì™„ë£Œ! í•´ë‹¹ ì‚¬ìš©ìëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                await loadAdminPanel();
                
            } catch (error) {
                console.error('ë³µê·€ ì˜¤ë¥˜:', error);
                alert('âŒ ë³µê·€ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ì—…ë°ì´íŠ¸ ëª©ë¡ ë¡œë“œ
        async function loadUpdates() {
            const { data: updates } = await supabase
                .from('updates')
                .select('*')
                .order('created_at', { ascending: false });
            
            const list = document.getElementById('updatesList');
            
            if (!updates || updates.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:#8b949e;padding:40px;">ì•„ì§ ì—…ë°ì´íŠ¸ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            list.innerHTML = updates.map(update => `
                <div style="background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <span style="background: #3a3a3a; color: #e0e0e0; padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: bold; margin-right: 10px; border: 1px solid #4a4a4a;">
                                ${update.version || 'v1.0.0'}
                            </span>
                            <span style="color: #e0e0e0; font-size: 18px; font-weight: bold;">
                                ${update.title}
                            </span>
                        </div>
                        ${isAdmin ? `
                            <div style="display: flex; gap: 8px;">
                                <button onclick="editUpdate(${update.id}, '${update.version?.replace(/'/g, "\\'")}', '${update.title.replace(/'/g, "\\'")}', \`${update.content.replace(/`/g, '\\`')}\`, '${update.download_url || ''}')" 
                                    style="background: #3a3a3a; color: #e0e0e0; border: 1px solid #4a4a4a; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    âœï¸ ìˆ˜ì •
                                </button>
                                <button onclick="deleteUpdate(${update.id})" 
                                    style="background: #f85149; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    ğŸ—‘ï¸ ì‚­ì œ
                                </button>
                            </div>
                        ` : ''}
                    </div>
                    <div style="color: #808080; font-size: 12px; margin-bottom: 15px;">
                        ${new Date(update.created_at).toLocaleString('ko-KR')} Â· ${update.created_by}
                    </div>
                    <div style="color: #b4b4b4; line-height: 1.6; white-space: pre-wrap; margin-bottom: 15px;">
                        ${update.content}
                    </div>
                    ${update.download_url ? `
                        <a href="${update.download_url}" target="_blank" 
                            style="display: inline-block; background: linear-gradient(135deg, #238636 0%, #2ea043 100%); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 14px; transition: transform 0.2s; margin-bottom: 15px;"
                            onmouseover="this.style.transform='translateY(-2px)'" 
                            onmouseout="this.style.transform='translateY(0)'">
                            ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                        </a>
                    ` : ''}
                    
                    <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
                    <div style="border-top: 1px solid #30363d; padding-top: 15px; margin-top: 15px;">
                        <div style="color: #8b949e; font-size: 14px; margin-bottom: 10px;">ğŸ’¬ ëŒ“ê¸€</div>
                        <div id="comments-${update.id}" style="margin-bottom: 10px;"></div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="commentInput-${update.id}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                                style="flex: 1; padding: 8px 12px; border-radius: 6px; border: 1px solid #30363d; background: #161b22; color: #c9d1d9; font-size: 13px;">
                            <button onclick="postComment(${update.id})" 
                                style="background: #238636; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; white-space: nowrap;">
                                ëŒ“ê¸€ ì‘ì„±
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // ê° ì—…ë°ì´íŠ¸ì˜ ëŒ“ê¸€ ë¡œë“œ
            updates.forEach(update => loadComments(update.id));
        }
        
        // ì—…ë°ì´íŠ¸ ê²Œì‹œ
        // ì—…ë°ì´íŠ¸ ê²Œì‹œ/ìˆ˜ì • í•¨ìˆ˜
        async function postUpdate() {
            const version = document.getElementById('updateVersion').value.trim();
            const title = document.getElementById('updateTitle').value.trim();
            const content = document.getElementById('updateContent').value.trim();
            const downloadUrl = document.getElementById('updateDownloadUrl').value.trim();
            
            if (!version || !title || !content) {
                alert('âš ï¸ ë²„ì „, ì œëª©, ë‚´ìš©ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤!');
                return;
            }
            
            try {
                if (editingUpdateId) {
                    // ìˆ˜ì • ëª¨ë“œ
                    const { error } = await supabase.from('updates')
                        .update({
                            version,
                            title,
                            content,
                            download_url: downloadUrl || null
                        })
                        .eq('id', editingUpdateId);
                    
                    if (error) throw error;
                    alert('âœ… ì—…ë°ì´íŠ¸ ê³µì§€ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    editingUpdateId = null;
                } else {
                    // ë“±ë¡ ëª¨ë“œ
                    const updateData = {
                        version,
                        title,
                        content,
                        created_by: currentUser,
                        download_url: downloadUrl || null
                    };
                    
                    const { error } = await supabase.from('updates').insert(updateData);
                    
                    if (error) throw error;
                    alert('âœ… ì—…ë°ì´íŠ¸ ê³µì§€ê°€ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                cancelEdit();
                loadUpdates();
                
            } catch (error) {
                alert('âŒ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ìˆ˜ì • ì·¨ì†Œ ë° í¼ ì´ˆê¸°í™”
        function cancelEdit() {
            editingUpdateId = null;
            document.getElementById('updateVersion').value = '';
            document.getElementById('updateTitle').value = '';
            document.getElementById('updateContent').value = '';
            document.getElementById('updateDownloadUrl').value = '';
            
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì›ë˜ëŒ€ë¡œ
            const btn = document.getElementById('postUpdateBtn');
            if (btn) {
                btn.textContent = 'ğŸ“¤ ê²Œì‹œí•˜ê¸°';
                btn.style.background = '#238636';
            }
        }
        
        // ì—…ë°ì´íŠ¸ ìˆ˜ì • (í¼ì— ë°ì´í„° ë„£ê¸°)
        let editingUpdateId = null;
        
        function editUpdate(id, version, title, content, downloadUrl) {
            editingUpdateId = id;
            
            // í¼ì— ê¸°ì¡´ ë°ì´í„° ë„£ê¸°
            document.getElementById('updateVersion').value = version || '';
            document.getElementById('updateTitle').value = title || '';
            document.getElementById('updateContent').value = content || '';
            document.getElementById('updateDownloadUrl').value = downloadUrl || '';
            
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
            const btn = document.getElementById('postUpdateBtn');
            if (btn) {
                btn.textContent = 'âœï¸ ìˆ˜ì • ì™„ë£Œ';
                btn.style.background = '#3a3a3a';
            }
            
            // ìŠ¤í¬ë¡¤ ì´ë™ (ì‘ì„± í¼ìœ¼ë¡œ)
            document.getElementById('updateWriteForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // ì—…ë°ì´íŠ¸ ì‚­ì œ
        async function deleteUpdate(id) {
            if (!confirm('ì´ ì—…ë°ì´íŠ¸ ê³µì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const { error } = await supabase.from('updates').delete().eq('id', id);
                
                if (error) throw error;
                
                alert('âœ… ì‚­ì œ ì™„ë£Œ');
                loadUpdates();
                
            } catch (error) {
                alert('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ë­í‚¹ ë¡œë“œ (ì˜¤ëŠ˜ì˜ ìŠ¹ìˆ˜ ìˆœìœ„)
        // ë­í‚¹ íƒ€ì… ì „í™˜
        let currentRankingType = 'wins';
        
        function showRankingType(type) {
            currentRankingType = type;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.getElementById('winsRankBtn').classList.toggle('active', type === 'wins');
            document.getElementById('scoreRankBtn').classList.toggle('active', type === 'score');
            
            // í…Œì´ë¸” í—¤ë” ë³€ê²½
            const thead = document.getElementById('rankingTableHead');
            if (type === 'wins') {
                thead.innerHTML = `
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ì‚¬ìš©ìëª…</th>
                        <th>ìŠ¹</th>
                        <th>íŒ¨</th>
                        <th>ë¬´</th>
                        <th>ìŠ¹ë¥ </th>
                    </tr>
                `;
            } else {
                thead.innerHTML = `
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ì‚¬ìš©ìëª…</th>
                        <th>ì‹¤ì‹œê°„ ì ìˆ˜</th>
                    </tr>
                `;
            }
            
            // ë­í‚¹ ë¡œë“œ
            if (type === 'wins') {
                loadWinsRanking();
            } else {
                loadScoreRanking();
            }
        }
        
        // ìµœë‹¤ìŠ¹ ë­í‚¹ (ì˜¤ëŠ˜ ê¸°ì¤€) (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ + ìºì‹±)
        async function loadWinsRanking(forceRefresh = false) {
            const today = getTodayKST();
            
            try {
                const now = Date.now();
                let sessions = cachedWinsRanking;
                
                if (forceRefresh || !cachedWinsRanking || now - lastWinsRankingLoad > RANKING_CACHE_TIME) {
                    const { data: freshSessions } = await supabase
                        .from('daily_sessions')
                        .select('username, wins, losses, draws')
                        .eq('session_date', today)
                        .order('wins', { ascending: false });
                    sessions = freshSessions;
                    cachedWinsRanking = freshSessions;
                    lastWinsRankingLoad = now;
                }
                
                const tbody = document.getElementById('rankingTableBody');
                
                if (!sessions || sessions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#808080;">ì˜¤ëŠ˜ ê²Œì„í•œ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }
                
                tbody.innerHTML = sessions.map((session, index) => {
                    const total = (session.wins || 0) + (session.losses || 0) + (session.draws || 0);
                    const winrate = total > 0 ? ((session.wins || 0) / total * 100).toFixed(1) : 0;
                    
                    let rankIcon = '';
                    if (index === 0) rankIcon = 'ğŸ¥‡';
                    else if (index === 1) rankIcon = 'ğŸ¥ˆ';
                    else if (index === 2) rankIcon = 'ğŸ¥‰';
                    else rankIcon = `${index + 1}`;
                    
                    return `
                        <tr style="background: ${index < 3 ? 'rgba(255, 215, 0, 0.05)' : 'transparent'};">
                            <td style="font-size: 18px; font-weight: bold;">${rankIcon}</td>
                            <td><strong>${session.username}</strong></td>
                            <td style="color: #86efac; font-weight: bold;">${session.wins || 0}</td>
                            <td style="color: #fca5a5;">${session.losses || 0}</td>
                            <td style="color: #fcd34d;">${session.draws || 0}</td>
                            <td style="color: #e0e0e0;">${winrate}%</td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('ë­í‚¹ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('rankingTableBody').innerHTML = 
                    '<tr><td colspan="6" style="text-align:center;color:#fca5a5;">ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨</td></tr>';
            }
        }
        
        // ì‹¤ì‹œê°„ ì ìˆ˜ ë­í‚¹ (Egress ìµœì í™”: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ + ìºì‹±)
        async function loadScoreRanking(forceRefresh = false) {
            try {
                const now = Date.now();
                let stats = cachedScoreRanking;
                
                if (forceRefresh || !cachedScoreRanking || now - lastScoreRankingLoad > RANKING_CACHE_TIME) {
                    const { data: freshStats } = await supabase
                        .from('game_stats')
                        .select('username, current_score')
                        .order('current_score', { ascending: false });
                    stats = freshStats;
                    cachedScoreRanking = freshStats;
                    lastScoreRankingLoad = now;
                }
                
                const tbody = document.getElementById('rankingTableBody');
                
                if (!stats || stats.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#808080;">ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }
                
                // current_scoreê°€ nullì´ê±°ë‚˜ 0ì¸ ì‚¬ìš©ì ì œì™¸ + 5ìë¦¬ ì´ìƒ(10000 ì´ìƒ) í•„í„°ë§
                const validStats = stats.filter(s => {
                    const score = Number(s.current_score);
                    return score && score > 0 && score < 10000; // 4ìë¦¬ ì´í•˜ë§Œ í—ˆìš©
                });
                
                if (validStats.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#808080;">ì ìˆ˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }
                
                tbody.innerHTML = validStats.map((stat, index) => {
                    let rankIcon = '';
                    if (index === 0) rankIcon = 'ğŸ¥‡';
                    else if (index === 1) rankIcon = 'ğŸ¥ˆ';
                    else if (index === 2) rankIcon = 'ğŸ¥‰';
                    else rankIcon = `${index + 1}`;
                    
                    // ìˆ«ìë¡œ ë³€í™˜ í›„ í‘œì‹œ (5ìë¦¬ ì´ìƒ ë°©ì§€)
                    const score = Number(stat.current_score);
                    const displayScore = (score < 10000) ? score : '--';
                    
                    return `
                        <tr style="background: ${index < 3 ? 'rgba(255, 215, 0, 0.05)' : 'transparent'};">
                            <td style="font-size: 18px; font-weight: bold;">${rankIcon}</td>
                            <td><strong>${stat.username}</strong></td>
                            <td style="color: #e0e0e0; font-weight: bold; font-size: 16px;">${displayScore !== '--' ? displayScore.toLocaleString() : '--'}</td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('ì ìˆ˜ ë­í‚¹ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('rankingTableBody').innerHTML = 
                    '<tr><td colspan="3" style="text-align:center;color:#fca5a5;">ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨</td></tr>';
            }
        }
        
        // ê¸°ë³¸ ë­í‚¹ ë¡œë“œ (í˜¸í™˜ì„±)
        async function loadRanking() {
            if (currentRankingType === 'wins') {
                await loadWinsRanking();
            } else {
                await loadScoreRanking();
            }
        }
        
        // ëŒ“ê¸€ ë¡œë“œ
        async function loadComments(updateId) {
            try {
                const { data: comments } = await supabase
                    .from('update_comments')
                    .select('*')
                    .eq('update_id', updateId)
                    .order('created_at', { ascending: true });
                
                const container = document.getElementById(`comments-${updateId}`);
                
                if (!comments || comments.length === 0) {
                    container.innerHTML = '<div style="color: #8b949e; font-size: 12px; padding: 10px 0;">ì²« ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</div>';
                    return;
                }
                
                container.innerHTML = comments.map(comment => `
                    <div style="background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="color: #58a6ff; font-weight: bold; font-size: 13px;">${comment.username}</span>
                            <span style="color: #8b949e; font-size: 11px;">${new Date(comment.created_at).toLocaleString('ko-KR')}</span>
                        </div>
                        <div style="color: #c9d1d9; font-size: 13px; line-height: 1.4;">${comment.comment}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('ëŒ“ê¸€ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ëŒ“ê¸€ ì‘ì„±
        async function postComment(updateId) {
            const input = document.getElementById(`commentInput-${updateId}`);
            const comment = input.value.trim();
            
            if (!comment) {
                alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('update_comments')
                    .insert({
                        update_id: updateId,
                        username: currentUser,
                        comment: comment
                    });
                
                if (error) throw error;
                
                input.value = '';
                loadComments(updateId);
                
            } catch (error) {
                console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
                alert('ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ê³µì§€ì‚¬í•­ ë¡œë“œ
        async function loadAnnouncements() {
            try {
                const { data: announcements } = await supabase
                    .from('announcements')
                    .select('*')
                    .eq('active', true)
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                const banner = document.getElementById('announcementBanner');
                
                if (!announcements || announcements.length === 0) {
                    banner.style.display = 'none';
                    return;
                }
                
                const announcement = announcements[0];
                const colors = {
                    info: { bg: '#1a2e3a', border: '#2a5a7a', text: '#58a6ff' },
                    success: { bg: '#1a2e26', border: '#2d4a3e', text: '#86efac' },
                    warning: { bg: '#2e2a1a', border: '#4a422d', text: '#fcd34d' },
                    error: { bg: '#2e1a1a', border: '#4a2d2d', text: '#fca5a5' }
                };
                
                const color = colors[announcement.type] || colors.info;
                
                banner.innerHTML = `
                    <div style="background: ${color.bg}; border: 1px solid ${color.border}; 
                                border-radius: 12px; padding: 15px 20px; margin-bottom: 20px; 
                                display: flex; align-items: center; justify-content: space-between;">
                        <div style="color: ${color.text}; font-weight: 600; flex: 1;">
                            ${announcement.message}
                        </div>
                        ${isAdmin ? `
                            <button onclick="deleteAnnouncement(${announcement.id})" 
                                    style="background: transparent; border: 1px solid ${color.border}; 
                                           color: ${color.text}; padding: 6px 12px; border-radius: 6px; 
                                           cursor: pointer; margin-left: 15px; font-size: 12px;">
                                ì‚­ì œ
                            </button>
                        ` : ''}
                    </div>
                `;
                banner.style.display = 'block';
                
            } catch (error) {
                console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ê³µì§€ì‚¬í•­ ì‘ì„± (ê´€ë¦¬ìë§Œ)
        async function createAnnouncement() {
            if (!isAdmin) {
                alert('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const message = document.getElementById('announcementInput').value.trim();
            const type = document.getElementById('announcementType').value;
            
            if (!message) {
                alert('ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            try {
                // ê¸°ì¡´ ê³µì§€ ë¹„í™œì„±í™”
                await supabase
                    .from('announcements')
                    .update({ active: false })
                    .eq('active', true);
                
                // ìƒˆ ê³µì§€ ìƒì„±
                const { error } = await supabase
                    .from('announcements')
                    .insert({
                        message: message,
                        type: type,
                        created_by: currentUser,
                        active: true
                    });
                
                if (error) throw error;
                
                alert('âœ… ê³µì§€ê°€ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!');
                document.getElementById('announcementInput').value = '';
                document.getElementById('announcementType').value = 'info';
                loadAnnouncements();
                
            } catch (error) {
                console.error('ê³µì§€ ì‘ì„± ì˜¤ë¥˜:', error);
                alert('âŒ ê³µì§€ ì‘ì„± ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ê³µì§€ì‚¬í•­ ì‚­ì œ (ê´€ë¦¬ìë§Œ)
        async function deleteAnnouncement(id) {
            if (!isAdmin) {
                alert('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ì´ ê³µì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const { error } = await supabase
                    .from('announcements')
                    .update({ active: false })
                    .eq('id', id);
                
                if (error) throw error;
                
                alert('ì‚­ì œ ì™„ë£Œ');
                loadAnnouncements();
                
            } catch (error) {
                console.error('ê³µì§€ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
    </script>
</body>
</html>

